!function(n,t,i){"use strict";function r(n){var t=n!=null?n.title:"NewEvent",r=(n!=null?n.start:new Date).toISOString(),u=r;i("#eventContent").load("/Event/Create",{Title:t,EventType:t,StartDate:r,EndDate:u},function(){i("#eventModal").dialog({title:"Create a new "+t,modal:!0,draggable:!0,width:"auto",open:function(){},close:function(){i("#eventContent").empty()},buttons:{Cancel:function(){i("#calendarCtrl").fullCalendar("removeEvents",function(t){return t._id===n._id});i("#eventModal").dialog("close")},Save:function(){var o=i("#EventTitle").val(),s=i("#EventType").val(),h=moment().format("YYYY-MM-DD"),t=i("#StartDate").val(),u=i("#StartTime").val(),r=i("#EndDate").val(),f=i("#EndTime").val(),c,e;if(h>t)alert("Start date must be in future !");else if(r>=t){if(r==t&&f<=u){alert("Wrong end time !");return}n.allDay=!1;n.title=o;n.eventType=s;n.start=t+" "+u;n.end=r+" "+f;c=i("select#participantDD").val();e={Title:n.title,EventType:n.eventType,StartDate:n.start,EndDate:n.end};i.ajax({type:"POST",url:"/Event/Register",data:e,error:function(n){alert(n.responseText)},success:function(){i("#calendarCtrl").fullCalendar("updateEvent",n);i("#eventModal").dialog("close")}})}else alert("Wrong end date !")}}});i("#newParticipant").on("click",function(){swal("Fill participant data")})})}function u(n){var t=n._id,r="/Event/Delete/"+t;swal({title:"Delete event",text:"Are you sure to delete event '"+n.title+"' ?",icon:"warning",buttons:["No","Yes, Delete it!"],dangerMode:!0}).then(function(t){t?(i("#calendarCtrl").fullCalendar("removeEvents",function(t){return t._id===n._id}),i.ajax({url:r,success:function(){swal({title:"Success!",text:"Event has been deleted!",icon:"success"}).then(function(){})}})):swal("Cancelled","Event is saved","error")})}function f(n){var r=moment(n.start).format("YYYY-MM-DD HH:mm A"),u=moment(n.end).format("YYYY-MM-DD HH:mm A"),t;n.eventType||(n.eventType=n.title);t={AllDay:!1,Id:n.id,EventType:n.eventType,Title:n.title,StartDate:r,EndDate:u};i("#eventContent").load("/Event/Details",t,function(){i("#eventModal").dialog({title:n.title,modal:!0,width:"auto",close:function(){i("#eventContent").empty()},buttons:{Cancel:function(){i(this).dialog("close")},Save:function(){var e=i("#EventTitle").val(),o=i("#EventType").val(),s=moment().format("YYYY-MM-DD"),t=i("#StartDate").val(),u=i("#StartTime").val(),r=i("#EndDate").val(),f=i("#EndTime").val();if(s>t)alert("Start date must be in future !");else if(r>=t){if(r==t&&f<=u){alert("Wrong end time !");return}n.title=e;n.eventType=o;n.allDay=!1;n.start=moment(t+" "+u);n.end=moment(r+" "+f);i("#calendarCtrl").fullCalendar("updateEvent",n);i(this).dialog("close")}else alert("Check end date, please !")}}});i("#newParticipant").on("click",function(){alert("Fill participant data")})})}i("#external-events .fc-event").each(function(){i(this).data("event",{title:i.trim(i(this).text()),stick:!0});i(this).draggable({zIndex:999,revert:!0,revertDuration:0})});i("#calendarCtrl").fullCalendar({schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",header:{left:"today,prev,next",center:"title",right:"agendaDay,agendaWeek,month"},editable:!0,droppable:!0,events:function(n,t,r,u){i.ajax({url:"/Event/GetCalendarData",type:"GET",dataType:"JSON",success:function(n){var t=[];i.each(n,function(n,i){t.push({id:i.Id,title:i.Title,allDay:!1,description:i.Desc,start:i.StartDate,end:i.EndDate,backgroundColor:"#9501fc",borderColor:"#fc0101"})});u(t)},error:function(n,t,i){alert(i)}})},select:function(n,t,i,r,u){console.log("select day !!!",n.format(),t.format(),u?u.id:"(no resource)")},drop:function(n){var t=n.format();i("#drop-remove").is(":checked")&&i(this).remove()},eventDrop:function(n){console.log("eventDrop",n)},eventReceive:function(n){r(n)},eventClick:function(n){f(n)},dayClick:function(n,t){i(this).on("mousedown",function(){i.contextMenu({selector:".fc-day",callback:function(n){switch(n){case"addEvent":r();break;case"delete":u(t)}},items:{addEvent:{name:"Create",icon:"create",url:"/Event/Create"}}})})},eventRender:function(n,t){t.attr("data-event-id",n.id);t.addClass("context-class");t.on("mousedown",function(t){t.which==3&&i.contextMenu({selector:".fc-event",callback:function(t){switch(t){case"addEvent":r();break;case"delete":u(n)}},items:{addEvent:{name:"Create",icon:"create",url:"/Event/Create"},editEvents:{name:"Edit",icon:"edit",url:"/Event/Edit"},copy:{name:"Copy",icon:"copy"},paste:{name:"Paste",icon:"paste"},"delete":{name:"Delete",icon:"delete",url:"/Event/Delete"},quit:{name:"Quit",icon:function(){return"context-menu-icon context-menu-icon-quit"}}}})})},eventAfterAllRender:function(){}})}(document,window,jQuery);